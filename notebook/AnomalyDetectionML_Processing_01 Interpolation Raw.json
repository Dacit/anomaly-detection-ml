{"paragraphs":[{"text":"%dep\n\nz.reset\nz.addRepo(\"Spark Packages Repo\").url(\"https://dl.bintray.com/spark-packages/maven\")\nz.addRepo(\"qaware-internal-snapshots\").url(\"https://www.qaware.de/nexus/content/repositories/qaware-internal-snapshots/\").username(\"f.huch\")\nz.load(\"de.qaware.mlwb:featureextractor:1.0-SNAPSHOT\")\nz.load(\"de.qaware.mlwb:mlwb-impl:1.2-SNAPSHOT\")\nz.load(\"org.apache.commons:commons-math3:3.6.1\")\n\nz.fetch","dateUpdated":"2017-12-04T10:57:42+0100","config":{"tableHide":true,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512381462260_15723068","id":"20170711-175327_627349371","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:26"},{"text":"%spark\nimport collection.JavaConverters._\nimport de.qaware.mlwb.api._\nimport de.qaware.mlwb.impl.sparksolr.MetricsServiceImpl\nimport java.sql.Timestamp\nimport org.apache.spark.sql.Encoders\nimport org.apache.spark.sql.Dataset","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport collection.JavaConverters._\n\nimport de.qaware.mlwb.api._\n\nimport de.qaware.mlwb.impl.sparksolr.MetricsServiceImpl\n\nimport java.sql.Timestamp\n\nimport org.apache.spark.sql.Encoders\n\nimport org.apache.spark.sql.Dataset\n"}]},"apps":[],"jobName":"paragraph_1512381462261_15338319","id":"20170721-104028_13196496","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27"},{"text":"%md\n\n# Uptime as example - before interpolation","dateUpdated":"2017-12-04T10:57:42+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Uptime as example - before interpolation</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1512381462261_15338319","id":"20171024-095905_1465215712","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:28"},{"text":"%spark\nval start = Timestamp.valueOf(\"2014-11-29 00:00:00\")\nval end = Timestamp.valueOf(\"2015-10-03 00:00:00\")\n\nval metricsQueryService = new MetricsServiceImpl.Factory(sqlc).getInstance(\"192.168.1.100:2181\", \"ekgdata\")\n\nval query = new QueryMetricContext.Builder().withMetrics(\"*Uptime*\").withHost(\"lp*\").withProcess(\"wls*\").withStart(start).withEnd(end).build\nval data = metricsQueryService.getCounters(query, Granularity.MINUTE, AggregationType.MIN)\n\ndata.createOrReplaceTempView(\"initial\")\nsqlc.cacheTable(\"initial\")\ndata.count\n\nsqlc.createDataset(data.first.getValuePoints.asScala)(Encoders.bean(classOf[ValuePoint])).createOrReplaceTempView(\"uptimeFirst\")\nsqlc.cacheTable(\"uptimeFirst\")","dateUpdated":"2017-12-04T10:57:42+0100","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nstart: java.sql.Timestamp = 2014-11-29 00:00:00.0\n\nend: java.sql.Timestamp = 2015-10-03 00:00:00.0\n\nmetricsQueryService: de.qaware.mlwb.api.MetricsService = de.qaware.mlwb.impl.sparksolr.MetricsServiceImpl@4f3fa88e\n\nquery: de.qaware.mlwb.api.QueryMetricContext = de.qaware.mlwb.api.QueryMetricContext@15b7bca1[series=*,host=lp*,process=wls*,start=2014-11-29 00:00:00.0,end=2015-10-03 00:00:00.0,rawQuery=<null>]\n\ndata: org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter] = [metric: struct<host: string, name: string ... 1 more field>, valuePoints: array<struct<date:timestamp,value:double>>]\n\nres13: Long = 20\n"}]},"apps":[],"jobName":"paragraph_1512381462262_16492566","id":"20170714-123513_60201966","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:29"},{"text":"%sql select * from uptimeFirst where date > '2015-05-02 20:00:00' and date < '2015-05-03' limit 1000","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"date","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"value","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"date\tvalue\n2015-05-02 20:01:00.0\t6.07461944E8\n2015-05-02 20:02:00.0\t6.07522911E8\n2015-05-02 20:03:00.0\t6.07583765E8\n2015-05-02 20:04:00.0\t6.07644577E8\n2015-05-02 20:05:00.0\t6.07705518E8\n2015-05-02 20:06:00.0\t6.07705518E8\n2015-05-02 20:07:00.0\t6.07766573E8\n2015-05-02 20:08:00.0\t6.07827683E8\n2015-05-02 20:09:00.0\t6.07889903E8\n2015-05-02 20:10:00.0\t6.07950976E8\n2015-05-02 20:11:00.0\t6.08012113E8\n2015-05-02 20:12:00.0\t6.08073935E8\n2015-05-02 20:13:00.0\t6.08135176E8\n2015-05-02 20:14:00.0\t6.08196576E8\n2015-05-02 20:15:00.0\t6.08258826E8\n2015-05-02 20:16:00.0\t6.08320326E8\n2015-05-02 20:17:00.0\t6.08382499E8\n2015-05-02 20:18:00.0\t6.08444727E8\n2015-05-02 20:19:00.0\t6.08506617E8\n2015-05-02 20:20:00.0\t6.08570258E8\n2015-05-02 20:21:00.0\t6.08632624E8\n2015-05-02 20:22:00.0\t6.08696275E8\n2015-05-02 20:23:00.0\t6.08759295E8\n2015-05-02 20:24:00.0\t6.08821688E8\n2015-05-02 20:25:00.0\t6.08885157E8\n2015-05-02 20:26:00.0\t6.08948673E8\n2015-05-02 20:27:00.0\t6.09010004E8\n2015-05-02 20:28:00.0\t6.09070989E8\n2015-05-02 20:29:00.0\t6.09132166E8\n2015-05-02 20:30:00.0\t6.09193748E8\n2015-05-02 20:31:00.0\t6.09254981E8\n2015-05-02 20:32:00.0\t6.09316062E8\n2015-05-02 20:33:00.0\t6.09377519E8\n2015-05-02 20:34:00.0\t6.09439092E8\n2015-05-02 20:35:00.0\t6.09500359E8\n2015-05-02 20:36:00.0\t6.09562167E8\n2015-05-02 20:37:00.0\t6.09623732E8\n2015-05-02 20:38:00.0\t6.09623732E8\n2015-05-02 20:39:00.0\t6.09685709E8\n2015-05-02 20:40:00.0\t6.09747555E8\n2015-05-02 20:41:00.0\t6.09809036E8\n2015-05-02 20:42:00.0\t6.09870434E8\n2015-05-02 20:43:00.0\t6.09931715E8\n2015-05-02 20:44:00.0\t6.09993245E8\n2015-05-02 20:45:00.0\t6.10054554E8\n2015-05-02 20:46:00.0\t6.10115815E8\n2015-05-02 20:47:00.0\t6.10177056E8\n2015-05-02 20:48:00.0\t6.10238351E8\n2015-05-02 20:49:00.0\t6.10299364E8\n2015-05-02 20:50:00.0\t6.10360425E8\n2015-05-02 20:51:00.0\t6.10421739E8\n2015-05-02 20:52:00.0\t6.1048292E8\n2015-05-02 20:53:00.0\t6.10544785E8\n2015-05-02 20:54:00.0\t6.10606736E8\n2015-05-02 20:55:00.0\t6.10668567E8\n2015-05-02 20:56:00.0\t6.10730771E8\n2015-05-02 20:57:00.0\t6.10792495E8\n2015-05-02 20:58:00.0\t6.10854238E8\n2015-05-02 20:59:00.0\t6.10916572E8\n2015-05-02 21:00:00.0\t6.10978858E8\n2015-05-02 21:01:00.0\t6.11041162E8\n2015-05-02 21:02:00.0\t6.11103153E8\n2015-05-02 21:03:00.0\t6.11164713E8\n2015-05-02 21:04:00.0\t6.11226271E8\n2015-05-02 21:05:00.0\t6.11287781E8\n2015-05-02 21:06:00.0\t6.1134889E8\n2015-05-02 21:07:00.0\t6.11410175E8\n2015-05-02 21:08:00.0\t6.11471546E8\n2015-05-02 21:09:00.0\t6.11532744E8\n2015-05-02 21:10:00.0\t6.1159446E8\n2015-05-02 21:11:00.0\t6.11655986E8\n2015-05-02 21:12:00.0\t6.11717553E8\n2015-05-02 21:13:00.0\t6.11778947E8\n2015-05-02 21:14:00.0\t6.11841246E8\n2015-05-02 21:15:00.0\t6.11903052E8\n2015-05-02 21:16:00.0\t6.11964599E8\n2015-05-02 21:17:00.0\t6.11964599E8\n2015-05-02 21:18:00.0\t6.1202613E8\n2015-05-02 21:19:00.0\t6.12087246E8\n2015-05-02 21:20:00.0\t6.12148915E8\n2015-05-02 21:21:00.0\t6.12210633E8\n2015-05-02 21:22:00.0\t6.12272217E8\n2015-05-02 21:23:00.0\t6.12333827E8\n2015-05-02 21:24:00.0\t6.12395506E8\n2015-05-02 21:25:00.0\t6.12456561E8\n2015-05-02 21:26:00.0\t6.12517736E8\n2015-05-02 21:27:00.0\t6.12579023E8\n2015-05-02 21:28:00.0\t6.12640684E8\n2015-05-02 21:29:00.0\t6.12703272E8\n2015-05-02 21:30:00.0\t6.12766638E8\n2015-05-02 21:31:00.0\t6.1282957E8\n2015-05-02 21:32:00.0\t6.12892877E8\n2015-05-02 21:33:00.0\t6.12955413E8\n2015-05-02 21:34:00.0\t6.13016266E8\n2015-05-02 21:35:00.0\t6.13077073E8\n2015-05-02 21:36:00.0\t6.1313803E8\n2015-05-02 21:37:00.0\t6.13198985E8\n2015-05-02 21:38:00.0\t6.13259927E8\n2015-05-02 21:39:00.0\t6.13321309E8\n2015-05-02 21:40:00.0\t6.13382644E8\n2015-05-02 21:41:00.0\t6.13444144E8\n2015-05-02 21:42:00.0\t6.13506065E8\n2015-05-02 21:43:00.0\t6.13567576E8\n2015-05-02 21:44:00.0\t6.1362902E8\n2015-05-02 21:45:00.0\t6.13690687E8\n2015-05-02 21:46:00.0\t6.13752286E8\n2015-05-02 21:47:00.0\t6.13813915E8\n2015-05-02 21:48:00.0\t6.13875225E8\n2015-05-02 21:49:00.0\t6.13936429E8\n2015-05-02 21:50:00.0\t6.13997713E8\n2015-05-02 21:51:00.0\t6.14059379E8\n2015-05-02 21:52:00.0\t6.1412112E8\n2015-05-02 21:53:00.0\t6.14182752E8\n2015-05-02 21:54:00.0\t6.1424399E8\n2015-05-02 21:55:00.0\t6.1430535E8\n2015-05-02 21:56:00.0\t6.1430535E8\n2015-05-02 21:57:00.0\t6.14366984E8\n2015-05-02 21:58:00.0\t6.14428379E8\n2015-05-02 21:59:00.0\t6.14489613E8\n2015-05-02 22:00:00.0\t6.14550611E8\n2015-05-02 22:01:00.0\t6.14611426E8\n2015-05-02 22:02:00.0\t6.1467225E8\n2015-05-02 22:03:00.0\t6.14733234E8\n2015-05-02 22:04:00.0\t-1.0\n2015-05-02 22:05:00.0\t98821.0\n2015-05-02 22:06:00.0\t159857.0\n2015-05-02 22:07:00.0\t220892.0\n2015-05-02 22:08:00.0\t281866.0\n2015-05-02 22:09:00.0\t342830.0\n2015-05-02 22:10:00.0\t403764.0\n2015-05-02 22:11:00.0\t464694.0\n2015-05-02 22:12:00.0\t525710.0\n2015-05-02 22:13:00.0\t586602.0\n2015-05-02 22:14:00.0\t647665.0\n2015-05-02 22:15:00.0\t708610.0\n2015-05-02 22:16:00.0\t769459.0\n2015-05-02 22:17:00.0\t830861.0\n2015-05-02 22:18:00.0\t891895.0\n2015-05-02 22:19:00.0\t952977.0\n2015-05-02 22:20:00.0\t1014418.0\n2015-05-02 22:21:00.0\t1075567.0\n2015-05-02 22:22:00.0\t1136746.0\n2015-05-02 22:23:00.0\t1198101.0\n2015-05-02 22:24:00.0\t1259213.0\n2015-05-02 22:25:00.0\t1320456.0\n2015-05-02 22:26:00.0\t1381234.0\n2015-05-02 22:27:00.0\t1442488.0\n2015-05-02 22:28:00.0\t1503617.0\n2015-05-02 22:29:00.0\t1564969.0\n2015-05-02 22:30:00.0\t1626174.0\n2015-05-02 22:31:00.0\t1687361.0\n2015-05-02 22:32:00.0\t1748771.0\n2015-05-02 22:33:00.0\t1810828.0\n2015-05-02 22:34:00.0\t1873102.0\n2015-05-02 22:35:00.0\t-1.0\n2015-05-02 22:36:00.0\t-1.0\n2015-05-02 22:37:00.0\t117336.0\n2015-05-02 22:38:00.0\t179139.0\n2015-05-02 22:39:00.0\t240488.0\n2015-05-02 22:40:00.0\t302581.0\n2015-05-02 22:41:00.0\t364198.0\n2015-05-02 22:42:00.0\t425743.0\n2015-05-02 22:43:00.0\t487288.0\n2015-05-02 22:44:00.0\t548594.0\n2015-05-02 22:45:00.0\t548594.0\n2015-05-02 22:46:00.0\t610020.0\n2015-05-02 22:47:00.0\t671339.0\n2015-05-02 22:48:00.0\t732804.0\n2015-05-02 22:49:00.0\t794325.0\n2015-05-02 22:50:00.0\t855228.0\n2015-05-02 22:51:00.0\t916257.0\n2015-05-02 22:52:00.0\t977141.0\n2015-05-02 22:53:00.0\t1038041.0\n2015-05-02 22:54:00.0\t1099085.0\n2015-05-02 22:55:00.0\t1159964.0\n2015-05-02 22:56:00.0\t1220875.0\n2015-05-02 22:57:00.0\t1281750.0\n2015-05-02 22:58:00.0\t1342615.0\n2015-05-02 22:59:00.0\t1403646.0\n2015-05-02 23:00:00.0\t1464519.0\n2015-05-02 23:01:00.0\t1525434.0\n2015-05-02 23:02:00.0\t1587095.0\n2015-05-02 23:03:00.0\t1649390.0\n2015-05-02 23:04:00.0\t1713930.0\n2015-05-02 23:05:00.0\t1777457.0\n2015-05-02 23:06:00.0\t1840866.0\n2015-05-02 23:07:00.0\t1903955.0\n2015-05-02 23:08:00.0\t1966841.0\n2015-05-02 23:09:00.0\t2029236.0\n2015-05-02 23:10:00.0\t2092139.0\n2015-05-02 23:11:00.0\t2155373.0\n2015-05-02 23:12:00.0\t2219332.0\n2015-05-02 23:13:00.0\t2281710.0\n2015-05-02 23:14:00.0\t2344035.0\n2015-05-02 23:15:00.0\t2405722.0\n2015-05-02 23:16:00.0\t2466662.0\n2015-05-02 23:17:00.0\t2527691.0\n2015-05-02 23:18:00.0\t2588841.0\n2015-05-02 23:19:00.0\t2588841.0\n2015-05-02 23:20:00.0\t2649875.0\n2015-05-02 23:21:00.0\t2710959.0\n2015-05-02 23:22:00.0\t2771935.0\n2015-05-02 23:23:00.0\t2832971.0\n2015-05-02 23:24:00.0\t2893916.0\n2015-05-02 23:25:00.0\t2954937.0\n2015-05-02 23:26:00.0\t3015939.0\n2015-05-02 23:27:00.0\t3076928.0\n2015-05-02 23:28:00.0\t3137821.0\n2015-05-02 23:29:00.0\t3198877.0\n2015-05-02 23:30:00.0\t3259760.0\n2015-05-02 23:31:00.0\t3320781.0\n2015-05-02 23:32:00.0\t3381889.0\n2015-05-02 23:33:00.0\t3443686.0\n2015-05-02 23:34:00.0\t3505188.0\n2015-05-02 23:35:00.0\t3567190.0\n2015-05-02 23:36:00.0\t3629102.0\n2015-05-02 23:37:00.0\t3691517.0\n2015-05-02 23:38:00.0\t3753558.0\n2015-05-02 23:39:00.0\t3815740.0\n2015-05-02 23:40:00.0\t3877417.0\n2015-05-02 23:41:00.0\t3939556.0\n2015-05-02 23:42:00.0\t4001485.0\n2015-05-02 23:43:00.0\t4063852.0\n2015-05-02 23:44:00.0\t4125773.0\n2015-05-02 23:45:00.0\t4187613.0\n2015-05-02 23:46:00.0\t4249137.0\n2015-05-02 23:47:00.0\t4310465.0\n2015-05-02 23:48:00.0\t4371767.0\n2015-05-02 23:49:00.0\t4433285.0\n2015-05-02 23:50:00.0\t4494579.0\n2015-05-02 23:51:00.0\t4555949.0\n2015-05-02 23:52:00.0\t4617138.0\n2015-05-02 23:53:00.0\t4678297.0\n2015-05-02 23:54:00.0\t4740049.0\n2015-05-02 23:55:00.0\t4802175.0\n2015-05-02 23:56:00.0\t4864649.0\n2015-05-02 23:57:00.0\t4927410.0\n2015-05-02 23:58:00.0\t4927410.0\n2015-05-02 23:59:00.0\t4989609.0\n"}]},"apps":[],"jobName":"paragraph_1512381462262_16492566","id":"20170714-132617_1764796744","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:30"},{"text":"%md\n\n# Interpolation","dateUpdated":"2017-12-04T10:57:42+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Interpolation</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1512381462263_16107817","id":"20171024-095931_346220459","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:31"},{"text":"%spark\nimport org.apache.commons.math3.analysis.interpolation.HermiteInterpolator\nimport scala.util.control.Breaks._\n\ndef interpolate(input: Dataset[Counter]): Dataset[Counter] = {\n    input.map(c => {\n        val values = c.getValuePoints\n        breakable { for (i <- 0 until values.size if values.get(i).getValue == -1.0) {\n            // Optionals for nearby points and their derivatives\n            var last = None: Option[Double]\n            var lastDeriv = None: Option[Double]\n            var next = None: Option[Double]\n            var nextDeriv = None: Option[Double]\n            \n            // Next value that is not minus one\n            var nextNonMissing = values.size\n            \n            // store left bound and derivative, if they exist.\n            if (i > 0) {\n                last = Some(values.get(i - 1).getValue)\n                if (i > 1) {\n                    lastDeriv = Some(last.get - values.get(i - 2).getValue)\n                }\n            }\n            \n            // add right bound and derivative, if they exist\n            (i + 1 until values.size).find(values.get(_).getValue != -1).foreach(n => {\n                next = Option(values.get(n).getValue)\n                nextNonMissing = n\n                \n                (n + 1 until values.size).find(values.get(_).getValue != -1).foreach(nn => {\n                    nextDeriv = Some((values.get(nn).getValue - next.get) / (nn - nextNonMissing))\n                })\n            })\n            \n            if (nextNonMissing < values.size && !last.isEmpty && (nextNonMissing - i) > 3) {\n                // Fail if no value exists \n                if (last.isEmpty && next.isEmpty) {\n                    break\n                } \n                \n                // Heremite Interpolation (used as linear interpolator)\n                val interpolator = new HermiteInterpolator()\n                \n                // Add vlaues to interpolator\n                if ((!lastDeriv.isEmpty && !next.isEmpty) || (!nextDeriv.isEmpty && !last.isEmpty)) {\n                    // Check if there is a jump in the curve\n                    if (last.get < next.get && nextDeriv.isEmpty && lastDeriv.get < 0) {\n                        // Curve goes down, then jumps up to point --> interpolate point as constant\n                        interpolator.addSamplePoint(nextNonMissing - i, Array(next.get))\n                    }\n                    else if (last.get < next.get && !nextDeriv.isEmpty && nextDeriv.get < 0 && (lastDeriv.isEmpty || Math.signum(lastDeriv.get) == Math.signum(nextDeriv.get))) {\n                        // Curve jumps upwards, interpolate from right only\n                        interpolator.addSamplePoint(nextNonMissing - i, Array(next.get))//, Array(nextDeriv.get))\n                    }\n                    else if (last.get > next.get && lastDeriv.isEmpty && nextDeriv.get > 0) {\n                        // Curve jumps down from point then goes up --> interpolate point as constant\n                        interpolator.addSamplePoint(-1, Array(last.get))\n                    }\n                    else if(last.get > next.get && !lastDeriv.isEmpty && lastDeriv.get > 0 && (nextDeriv.isEmpty || Math.signum(lastDeriv.get) == Math.signum(nextDeriv.get))) {\n                        // Curve jumps downwards, interpolate from left only\n                        interpolator.addSamplePoint(-1, Array(last.get))//, Array(lastDeriv.get))\n                    }\n                    else {\n                        // No jump, interpolate from all\n                        interpolator.addSamplePoint(-1, Array(last.get))//, Array(lastDeriv.get))\n                        interpolator.addSamplePoint(nextNonMissing - i, Array(next.get))//, Array(nextDeriv.get))\n                    }\n                } else {\n                    // No jump possible - just add all existing values\n                    if (!last.isEmpty) {\n                        interpolator.addSamplePoint(-1, Array(last.get))\n                    } else if(nextNonMissing - i > 60) {\n                        interpolator.addSamplePoint(-1, Array(0.0))\n                    }\n                    if (!next.isEmpty) {\n                        interpolator.addSamplePoint(nextNonMissing - i, Array(next.get))\n                    } else if (nextNonMissing - i > 60) {\n                        interpolator.addSamplePoint(nextNonMissing - i, Array(0.0))\n                    }\n                }\n                \n                // Interpolate all values in interval 1 until (nex.head - i)\n                for (step <- 0 until (nextNonMissing - i)) {\n                    val interpolatedVal = interpolator.value(step)(0)\n                    if (interpolatedVal < 0) {\n                        println(\"###### Interpolated value < 0: \" + interpolatedVal + \"! last: \" + last + \" lastderiv: \" + lastDeriv + \" next: \" + next + \" nextDeriv: \" + nextDeriv + \" ########\")\n                    }\n                    values.get(i + step).setValue(interpolatedVal)\n                }\n            } else {\n                i = nextNonMissing\n            }\n        }}\n        c\n    }) (Encoders.bean(classOf[Counter]))\n    .filter(!_.getValuePoints.isEmpty)\n}","dateUpdated":"2017-12-04T11:05:32+0100","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.commons.math3.analysis.interpolation.HermiteInterpolator\n\nimport scala.util.control.Breaks._\n\ninterpolate: (input: org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter])org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter]\n"}]},"apps":[],"jobName":"paragraph_1512381462263_16107817","id":"20170712-103647_698609679","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:32"},{"text":"%spark\nobject RangeContext {\n    val start = Timestamp.valueOf(\"2014-12-01 00:00:00\")\n    val end = Timestamp.valueOf(\"2015-9-01 00:00:00\")\n}\n\ndef inRange(input: Dataset[Counter]): Dataset[Counter] = {\n    input.filter(c => {\n        val head = c.getValuePoints.get(0).getDate\n        val tail = c.getValuePoints.get(c.getValuePoints.size - 1).getDate\n        (head.before(RangeContext.start) || head.equals(RangeContext.start)) && (tail.after(RangeContext.end) || tail.equals(RangeContext.end))\n    })\n}","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndefined object RangeContext\n\ninRange: (input: org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter])org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter]\n"}]},"apps":[],"jobName":"paragraph_1512381462264_14184073","id":"20170726-145027_1112899414","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:33"},{"text":"%md\n\n# Previous Example interpolated","dateUpdated":"2017-12-04T10:57:42+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Previous Example interpolated</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1512381462264_14184073","id":"20171024-095953_1694434584","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34"},{"text":"val interpolated = interpolate(sqlc.table(\"initial\").as(Encoders.bean(classOf[Counter])))\nval uptimeIFirst = interpolated.limit(1).flatMap(_.getValuePoints.asScala)(Encoders.bean(classOf[ValuePoint]))\nuptimeIFirst.createOrReplaceTempView(\"uptimeIFirst\")\nuptimeIFirst.count\nsqlc.cacheTable(\"uptimeIFirst\")","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ninterpolated: org.apache.spark.sql.Dataset[de.qaware.mlwb.api.Counter] = [metric: struct<host: string, name: string ... 1 more field>, valuePoints: array<struct<date:timestamp,value:double>>]\n\nuptimeIFirst: org.apache.spark.sql.Dataset[de.qaware.mlwb.api.ValuePoint] = [date: timestamp, value: double]\n\nres20: Long = 399102\n"}]},"apps":[],"jobName":"paragraph_1512381462264_14184073","id":"20171024-161536_483909404","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:35"},{"text":"%sql select * from uptimeIFirst where date > '2015-05-02 20:00:00' and date < '2015-05-03' limit 1000","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"date\tvalue\n2015-05-02 20:01:00.0\t6.07461944E8\n2015-05-02 20:02:00.0\t6.07522911E8\n2015-05-02 20:03:00.0\t6.07583765E8\n2015-05-02 20:04:00.0\t6.07644577E8\n2015-05-02 20:05:00.0\t6.07705518E8\n2015-05-02 20:06:00.0\t6.07705518E8\n2015-05-02 20:07:00.0\t6.07766573E8\n2015-05-02 20:08:00.0\t6.07827683E8\n2015-05-02 20:09:00.0\t6.07889903E8\n2015-05-02 20:10:00.0\t6.07950976E8\n2015-05-02 20:11:00.0\t6.08012113E8\n2015-05-02 20:12:00.0\t6.08073935E8\n2015-05-02 20:13:00.0\t6.08135176E8\n2015-05-02 20:14:00.0\t6.08196576E8\n2015-05-02 20:15:00.0\t6.08258826E8\n2015-05-02 20:16:00.0\t6.08320326E8\n2015-05-02 20:17:00.0\t6.08382499E8\n2015-05-02 20:18:00.0\t6.08444727E8\n2015-05-02 20:19:00.0\t6.08506617E8\n2015-05-02 20:20:00.0\t6.08570258E8\n2015-05-02 20:21:00.0\t6.08632624E8\n2015-05-02 20:22:00.0\t6.08696275E8\n2015-05-02 20:23:00.0\t6.08759295E8\n2015-05-02 20:24:00.0\t6.08821688E8\n2015-05-02 20:25:00.0\t6.08885157E8\n2015-05-02 20:26:00.0\t6.08948673E8\n2015-05-02 20:27:00.0\t6.09010004E8\n2015-05-02 20:28:00.0\t6.09070989E8\n2015-05-02 20:29:00.0\t6.09132166E8\n2015-05-02 20:30:00.0\t6.09193748E8\n2015-05-02 20:31:00.0\t6.09254981E8\n2015-05-02 20:32:00.0\t6.09316062E8\n2015-05-02 20:33:00.0\t6.09377519E8\n2015-05-02 20:34:00.0\t6.09439092E8\n2015-05-02 20:35:00.0\t6.09500359E8\n2015-05-02 20:36:00.0\t6.09562167E8\n2015-05-02 20:37:00.0\t6.09623732E8\n2015-05-02 20:38:00.0\t6.09623732E8\n2015-05-02 20:39:00.0\t6.09685709E8\n2015-05-02 20:40:00.0\t6.09747555E8\n2015-05-02 20:41:00.0\t6.09809036E8\n2015-05-02 20:42:00.0\t6.09870434E8\n2015-05-02 20:43:00.0\t6.09931715E8\n2015-05-02 20:44:00.0\t6.09993245E8\n2015-05-02 20:45:00.0\t6.10054554E8\n2015-05-02 20:46:00.0\t6.10115815E8\n2015-05-02 20:47:00.0\t6.10177056E8\n2015-05-02 20:48:00.0\t6.10238351E8\n2015-05-02 20:49:00.0\t6.10299364E8\n2015-05-02 20:50:00.0\t6.10360425E8\n2015-05-02 20:51:00.0\t6.10421739E8\n2015-05-02 20:52:00.0\t6.1048292E8\n2015-05-02 20:53:00.0\t6.10544785E8\n2015-05-02 20:54:00.0\t6.10606736E8\n2015-05-02 20:55:00.0\t6.10668567E8\n2015-05-02 20:56:00.0\t6.10730771E8\n2015-05-02 20:57:00.0\t6.10792495E8\n2015-05-02 20:58:00.0\t6.10854238E8\n2015-05-02 20:59:00.0\t6.10916572E8\n2015-05-02 21:00:00.0\t6.10978858E8\n2015-05-02 21:01:00.0\t6.11041162E8\n2015-05-02 21:02:00.0\t6.11103153E8\n2015-05-02 21:03:00.0\t6.11164713E8\n2015-05-02 21:04:00.0\t6.11226271E8\n2015-05-02 21:05:00.0\t6.11287781E8\n2015-05-02 21:06:00.0\t6.1134889E8\n2015-05-02 21:07:00.0\t6.11410175E8\n2015-05-02 21:08:00.0\t6.11471546E8\n2015-05-02 21:09:00.0\t6.11532744E8\n2015-05-02 21:10:00.0\t6.1159446E8\n2015-05-02 21:11:00.0\t6.11655986E8\n2015-05-02 21:12:00.0\t6.11717553E8\n2015-05-02 21:13:00.0\t6.11778947E8\n2015-05-02 21:14:00.0\t6.11841246E8\n2015-05-02 21:15:00.0\t6.11903052E8\n2015-05-02 21:16:00.0\t6.11964599E8\n2015-05-02 21:17:00.0\t6.11964599E8\n2015-05-02 21:18:00.0\t6.1202613E8\n2015-05-02 21:19:00.0\t6.12087246E8\n2015-05-02 21:20:00.0\t6.12148915E8\n2015-05-02 21:21:00.0\t6.12210633E8\n2015-05-02 21:22:00.0\t6.12272217E8\n2015-05-02 21:23:00.0\t6.12333827E8\n2015-05-02 21:24:00.0\t6.12395506E8\n2015-05-02 21:25:00.0\t6.12456561E8\n2015-05-02 21:26:00.0\t6.12517736E8\n2015-05-02 21:27:00.0\t6.12579023E8\n2015-05-02 21:28:00.0\t6.12640684E8\n2015-05-02 21:29:00.0\t6.12703272E8\n2015-05-02 21:30:00.0\t6.12766638E8\n2015-05-02 21:31:00.0\t6.1282957E8\n2015-05-02 21:32:00.0\t6.12892877E8\n2015-05-02 21:33:00.0\t6.12955413E8\n2015-05-02 21:34:00.0\t6.13016266E8\n2015-05-02 21:35:00.0\t6.13077073E8\n2015-05-02 21:36:00.0\t6.1313803E8\n2015-05-02 21:37:00.0\t6.13198985E8\n2015-05-02 21:38:00.0\t6.13259927E8\n2015-05-02 21:39:00.0\t6.13321309E8\n2015-05-02 21:40:00.0\t6.13382644E8\n2015-05-02 21:41:00.0\t6.13444144E8\n2015-05-02 21:42:00.0\t6.13506065E8\n2015-05-02 21:43:00.0\t6.13567576E8\n2015-05-02 21:44:00.0\t6.1362902E8\n2015-05-02 21:45:00.0\t6.13690687E8\n2015-05-02 21:46:00.0\t6.13752286E8\n2015-05-02 21:47:00.0\t6.13813915E8\n2015-05-02 21:48:00.0\t6.13875225E8\n2015-05-02 21:49:00.0\t6.13936429E8\n2015-05-02 21:50:00.0\t6.13997713E8\n2015-05-02 21:51:00.0\t6.14059379E8\n2015-05-02 21:52:00.0\t6.1412112E8\n2015-05-02 21:53:00.0\t6.14182752E8\n2015-05-02 21:54:00.0\t6.1424399E8\n2015-05-02 21:55:00.0\t6.1430535E8\n2015-05-02 21:56:00.0\t6.1430535E8\n2015-05-02 21:57:00.0\t6.14366984E8\n2015-05-02 21:58:00.0\t6.14428379E8\n2015-05-02 21:59:00.0\t6.14489613E8\n2015-05-02 22:00:00.0\t6.14550611E8\n2015-05-02 22:01:00.0\t6.14611426E8\n2015-05-02 22:02:00.0\t6.1467225E8\n2015-05-02 22:03:00.0\t6.14733234E8\n2015-05-02 22:04:00.0\t6.14733234E8\n2015-05-02 22:05:00.0\t98821.0\n2015-05-02 22:06:00.0\t159857.0\n2015-05-02 22:07:00.0\t220892.0\n2015-05-02 22:08:00.0\t281866.0\n2015-05-02 22:09:00.0\t342830.0\n2015-05-02 22:10:00.0\t403764.0\n2015-05-02 22:11:00.0\t464694.0\n2015-05-02 22:12:00.0\t525710.0\n2015-05-02 22:13:00.0\t586602.0\n2015-05-02 22:14:00.0\t647665.0\n2015-05-02 22:15:00.0\t708610.0\n2015-05-02 22:16:00.0\t769459.0\n2015-05-02 22:17:00.0\t830861.0\n2015-05-02 22:18:00.0\t891895.0\n2015-05-02 22:19:00.0\t952977.0\n2015-05-02 22:20:00.0\t1014418.0\n2015-05-02 22:21:00.0\t1075567.0\n2015-05-02 22:22:00.0\t1136746.0\n2015-05-02 22:23:00.0\t1198101.0\n2015-05-02 22:24:00.0\t1259213.0\n2015-05-02 22:25:00.0\t1320456.0\n2015-05-02 22:26:00.0\t1381234.0\n2015-05-02 22:27:00.0\t1442488.0\n2015-05-02 22:28:00.0\t1503617.0\n2015-05-02 22:29:00.0\t1564969.0\n2015-05-02 22:30:00.0\t1626174.0\n2015-05-02 22:31:00.0\t1687361.0\n2015-05-02 22:32:00.0\t1748771.0\n2015-05-02 22:33:00.0\t1810828.0\n2015-05-02 22:34:00.0\t1873102.0\n2015-05-02 22:35:00.0\t1873102.0\n2015-05-02 22:36:00.0\t1873102.0\n2015-05-02 22:37:00.0\t117336.0\n2015-05-02 22:38:00.0\t179139.0\n2015-05-02 22:39:00.0\t240488.0\n2015-05-02 22:40:00.0\t302581.0\n2015-05-02 22:41:00.0\t364198.0\n2015-05-02 22:42:00.0\t425743.0\n2015-05-02 22:43:00.0\t487288.0\n2015-05-02 22:44:00.0\t548594.0\n2015-05-02 22:45:00.0\t548594.0\n2015-05-02 22:46:00.0\t610020.0\n2015-05-02 22:47:00.0\t671339.0\n2015-05-02 22:48:00.0\t732804.0\n2015-05-02 22:49:00.0\t794325.0\n2015-05-02 22:50:00.0\t855228.0\n2015-05-02 22:51:00.0\t916257.0\n2015-05-02 22:52:00.0\t977141.0\n2015-05-02 22:53:00.0\t1038041.0\n2015-05-02 22:54:00.0\t1099085.0\n2015-05-02 22:55:00.0\t1159964.0\n2015-05-02 22:56:00.0\t1220875.0\n2015-05-02 22:57:00.0\t1281750.0\n2015-05-02 22:58:00.0\t1342615.0\n2015-05-02 22:59:00.0\t1403646.0\n2015-05-02 23:00:00.0\t1464519.0\n2015-05-02 23:01:00.0\t1525434.0\n2015-05-02 23:02:00.0\t1587095.0\n2015-05-02 23:03:00.0\t1649390.0\n2015-05-02 23:04:00.0\t1713930.0\n2015-05-02 23:05:00.0\t1777457.0\n2015-05-02 23:06:00.0\t1840866.0\n2015-05-02 23:07:00.0\t1903955.0\n2015-05-02 23:08:00.0\t1966841.0\n2015-05-02 23:09:00.0\t2029236.0\n2015-05-02 23:10:00.0\t2092139.0\n2015-05-02 23:11:00.0\t2155373.0\n2015-05-02 23:12:00.0\t2219332.0\n2015-05-02 23:13:00.0\t2281710.0\n2015-05-02 23:14:00.0\t2344035.0\n2015-05-02 23:15:00.0\t2405722.0\n2015-05-02 23:16:00.0\t2466662.0\n2015-05-02 23:17:00.0\t2527691.0\n2015-05-02 23:18:00.0\t2588841.0\n2015-05-02 23:19:00.0\t2588841.0\n2015-05-02 23:20:00.0\t2649875.0\n2015-05-02 23:21:00.0\t2710959.0\n2015-05-02 23:22:00.0\t2771935.0\n2015-05-02 23:23:00.0\t2832971.0\n2015-05-02 23:24:00.0\t2893916.0\n2015-05-02 23:25:00.0\t2954937.0\n2015-05-02 23:26:00.0\t3015939.0\n2015-05-02 23:27:00.0\t3076928.0\n2015-05-02 23:28:00.0\t3137821.0\n2015-05-02 23:29:00.0\t3198877.0\n2015-05-02 23:30:00.0\t3259760.0\n2015-05-02 23:31:00.0\t3320781.0\n2015-05-02 23:32:00.0\t3381889.0\n2015-05-02 23:33:00.0\t3443686.0\n2015-05-02 23:34:00.0\t3505188.0\n2015-05-02 23:35:00.0\t3567190.0\n2015-05-02 23:36:00.0\t3629102.0\n2015-05-02 23:37:00.0\t3691517.0\n2015-05-02 23:38:00.0\t3753558.0\n2015-05-02 23:39:00.0\t3815740.0\n2015-05-02 23:40:00.0\t3877417.0\n2015-05-02 23:41:00.0\t3939556.0\n2015-05-02 23:42:00.0\t4001485.0\n2015-05-02 23:43:00.0\t4063852.0\n2015-05-02 23:44:00.0\t4125773.0\n2015-05-02 23:45:00.0\t4187613.0\n2015-05-02 23:46:00.0\t4249137.0\n2015-05-02 23:47:00.0\t4310465.0\n2015-05-02 23:48:00.0\t4371767.0\n2015-05-02 23:49:00.0\t4433285.0\n2015-05-02 23:50:00.0\t4494579.0\n2015-05-02 23:51:00.0\t4555949.0\n2015-05-02 23:52:00.0\t4617138.0\n2015-05-02 23:53:00.0\t4678297.0\n2015-05-02 23:54:00.0\t4740049.0\n2015-05-02 23:55:00.0\t4802175.0\n2015-05-02 23:56:00.0\t4864649.0\n2015-05-02 23:57:00.0\t4927410.0\n2015-05-02 23:58:00.0\t4927410.0\n2015-05-02 23:59:00.0\t4989609.0\n"}]},"apps":[],"jobName":"paragraph_1512381462265_13799324","id":"20170714-133556_1803052096","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:36"},{"text":"","dateUpdated":"2017-12-04T10:57:42+0100","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512381462266_14953570","id":"20170714-142541_933566631","dateCreated":"2017-12-04T10:57:42+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:37"}],"name":"AnomalyDetectionML/Processing/01 Interpolation Raw","id":"2CZRBK318","angularObjects":{"2CZ6JJTDR:shared_process":[],"2CZU9K4SP:shared_process":[],"2CYR4Y5D7:shared_process":[],"2D33TFRH4:shared_process":[],"2D18HK2TW:shared_process":[],"2D15EVSM5:shared_process":[],"2D2FQENTY:shared_process":[],"2CY5C8M4U:shared_process":[],"2CZGJ6DT8:shared_process":[],"2D2H4Y35Y:shared_process":[],"2D21J2RXK:shared_process":[],"2D2QUK9JC:shared_process":[],"2CYJWH63V:shared_process":[],"2D2XZGK45:shared_process":[],"2D1F6X9XF:shared_process":[],"2CY8V4V41:shared_process":[],"2D1JVM9EC:shared_process":[],"2D2NZHKM4:shared_process":[],"2D2E56F9K:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}